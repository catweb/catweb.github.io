'use strict';

/* test */
var appTest = function () {
    var $FORM;
    var $ITEMS;
    var $NUMBERS;
    var $PREV;
    var $NEXT;
    var CURRENT;

    function showCurrent() {
        $ITEMS.removeClass('active');
        $ITEMS.eq(CURRENT).addClass('active');

        $NUMBERS.removeClass('quiz_question__numbers__item-current quiz_question__numbers__item-passed');
        $NUMBERS.eq(CURRENT).addClass('quiz_question__numbers__item-current').prevAll().addClass('quiz_question__numbers__item-passed');

        if (CURRENT === 0) {
            $PREV.hide();
        } else {
            $PREV.show();
        }
    }

    function setup() {
        $PREV.on('click', function (e) {
            e.preventDefault();
            if (CURRENT === 0) return;
            CURRENT -= 1;
            showCurrent();
        });
        $NEXT.on('click', function (e) {
            e.preventDefault();
            if (CURRENT === $ITEMS.length - 1) {
                $FORM.submit();
            } else {
                CURRENT += 1;
                showCurrent();
            }
        });
    }

    return {
        init: function init() {
            $FORM = $('.jsTestForm');
            $PREV = $('.jsTestPrev');
            $NEXT = $('.jsTestNext');
            $ITEMS = $('.jsTestList').children();
            $NUMBERS = $('.jsTestNumbers').children();
            CURRENT = 0;

            setup();
        }
    };
}();
appTest.init();

/* slider */
var appSlider = function () {
    var $ITEMS;
    var ITEMS_LENGTH;
    var $PREV;
    var $NEXT;
    var CURRENT;

    function showCurrent() {
        $ITEMS.removeClass('active');
        $ITEMS.eq(CURRENT).addClass('active');
    }

    function setup() {
        $NEXT.on('click', function (e) {
            e.preventDefault();
            CURRENT = CURRENT + 1 < ITEMS_LENGTH ? CURRENT + 1 : 0;
            showCurrent();
        });
        $PREV.on('click', function (e) {
            e.preventDefault();
            CURRENT = CURRENT - 1 >= 0 ? CURRENT - 1 : ITEMS_LENGTH - 1;
            showCurrent();
        });
    }

    return {
        init: function init() {
            $ITEMS = $('.main_adv__slider__list').children();
            ITEMS_LENGTH = $ITEMS.length;
            if (!ITEMS_LENGTH) return;
            $PREV = $('.main_adv__slider__arrow-prev');
            $NEXT = $('.main_adv__slider__arrow-next');
            CURRENT = 0;

            setup();
        }
    };
}();
appSlider.init();

/* popup */
var appPopup = function () {
    var $BODY;
    var $CONTENT;
    var $POPUP;

    function open(html) {
        close();

        var bodyWidth = $BODY.width();
        $BODY.css({
            position: 'relative',
            overflow: 'hidden'
        });
        $BODY.css({
            paddingRight: $BODY.width() - bodyWidth, //vertical scroll width
            width: 'auto'
        });

        $CONTENT.html(html);
        $POPUP.show();
    }

    function close() {
        $POPUP.hide();
        $CONTENT.html('');
        $BODY.removeAttr('style');
    }

    return {
        init: function init() {
            $BODY = $('body');
            $POPUP = $('' + '<div class="popup">' + '<div class="popup__overlay"></div>' + '<div class="popup__container">' + '<div class="popup__content">' + '<div class="popup__item">' + '<div class="popup__close"></div>' + '<div class="popup__item__content"></div>' + '</div>' + '</div>' + '</div>' + '</div>' + '');
            $CONTENT = $POPUP.find('.popup__item__content');

            $POPUP.hide().find('.popup__close, .popup__overlay').on('click', function (e) {
                e.preventDefault();
                close();
            });

            $BODY.append($POPUP);

            $BODY.on('click', '.jsPopupClose', function (e) {
                e.preventDefault();
                close();
            });
        },
        close: close,
        open: open
    };
}();
appPopup.init();

/* video */
(function () {
    $('.main_adv__slider__list__play').on('click', function (e) {
        e.preventDefault();
        var src = $(this).attr('data-src');
        var html = '<div class="popup__video"><iframe src="https://www.youtube.com/embed/' + src + '?autoplay=1&wmode=transparent" width="100%" height="100%" frameborder="0" allowfullscreen wmode="Opaque"></iframe></div>';

        appPopup.open(html);
    });
})();

/* form */
(function () {
    var $form = $('.jsForm');
    var $capImg = $form.find('.jsFormCapImg');
    var $capInput = $form.find('.jsFormCapInput');

    var onResponse = function onResponse(response) {
        var message = '<div class="popup__message">' + response.message + '</div>';
        if (!!response.success) {
            $form.find('input, textarea').not(':submit').val('');
        }
        appPopup.open(message);
        $capImg.attr("src", response.src);
        $capInput.val(response.sid);
    };

    $form.on('submit', function (e) {
        e.preventDefault();
        $.ajax({
            url: $form.attr('action'),
            data: $form.serialize(),
            dataType: 'json',
            error: function error(_error) {
                console.log(_error);
            },
            success: onResponse
        });
    });
})();

/* burger */
(function () {
    $('.header__burger').on('click', function (e) {
        e.preventDefault();
        $('.header__drop').toggleClass('active');
    });
})();

/* articles upload */
(function () {
    var $upList = $('.jsUploadList');
    var $upButton = $('.jsUploadButton');
    var FLAG = true;

    $upButton.on('click', function (e) {
        e.preventDefault();
        if (!FLAG) return;
        FLAG = false;
        var url = $(this).attr('data-url');
        $.ajax({
            url: url,
            dataType: "json",
            error: function error(_error2) {
                console.log(_error2);
            },
            success: function success(response) {
                $upList.append(response.html);
                if (response.isLast) {
                    $upButton.hide();
                } else {
                    FLAG = true;
                }
            }
        });
    });
})();

/* specialists */
$(function () {
    var $docPopup = $('#doctors__popup');
    if ($docPopup.length) {
        appPopup.open($docPopup.html());
    }
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsiYXBwVGVzdCIsIiRGT1JNIiwiJElURU1TIiwiJE5VTUJFUlMiLCIkUFJFViIsIiRORVhUIiwiQ1VSUkVOVCIsInNob3dDdXJyZW50IiwicmVtb3ZlQ2xhc3MiLCJlcSIsImFkZENsYXNzIiwicHJldkFsbCIsImhpZGUiLCJzaG93Iiwic2V0dXAiLCJvbiIsImUiLCJwcmV2ZW50RGVmYXVsdCIsImxlbmd0aCIsInN1Ym1pdCIsImluaXQiLCIkIiwiY2hpbGRyZW4iLCJhcHBTbGlkZXIiLCJJVEVNU19MRU5HVEgiLCJhcHBQb3B1cCIsIiRCT0RZIiwiJENPTlRFTlQiLCIkUE9QVVAiLCJvcGVuIiwiaHRtbCIsImNsb3NlIiwiYm9keVdpZHRoIiwid2lkdGgiLCJjc3MiLCJwb3NpdGlvbiIsIm92ZXJmbG93IiwicGFkZGluZ1JpZ2h0IiwicmVtb3ZlQXR0ciIsImZpbmQiLCJhcHBlbmQiLCJzcmMiLCJhdHRyIiwiJGZvcm0iLCIkY2FwSW1nIiwiJGNhcElucHV0Iiwib25SZXNwb25zZSIsInJlc3BvbnNlIiwibWVzc2FnZSIsInN1Y2Nlc3MiLCJub3QiLCJ2YWwiLCJzaWQiLCJhamF4IiwidXJsIiwiZGF0YSIsInNlcmlhbGl6ZSIsImRhdGFUeXBlIiwiZXJyb3IiLCJjb25zb2xlIiwibG9nIiwidG9nZ2xlQ2xhc3MiLCIkdXBMaXN0IiwiJHVwQnV0dG9uIiwiRkxBRyIsImlzTGFzdCIsIiRkb2NQb3B1cCJdLCJtYXBwaW5ncyI6Ijs7QUFBQTtBQUNBLElBQUFBLFVBQUEsWUFBQTtBQUNBLFFBQUFDLEtBQUE7QUFDQSxRQUFBQyxNQUFBO0FBQ0EsUUFBQUMsUUFBQTtBQUNBLFFBQUFDLEtBQUE7QUFDQSxRQUFBQyxLQUFBO0FBQ0EsUUFBQUMsT0FBQTs7QUFFQSxhQUFBQyxXQUFBLEdBQUE7QUFDQUwsZUFBQU0sV0FBQSxDQUFBLFFBQUE7QUFDQU4sZUFBQU8sRUFBQSxDQUFBSCxPQUFBLEVBQUFJLFFBQUEsQ0FBQSxRQUFB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QUFBO0FBQ0E7QUFDQSxDQUxBIiwiZmlsZSI6Im1haW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiB0ZXN0ICovXG52YXIgYXBwVGVzdCA9IChmdW5jdGlvbigpe1xuICAgIHZhciAkRk9STTtcbiAgICB2YXIgJElURU1TO1xuICAgIHZhciAkTlVNQkVSUztcbiAgICB2YXIgJFBSRVY7XG4gICAgdmFyICRORVhUO1xuICAgIHZhciBDVVJSRU5UO1xuXG4gICAgZnVuY3Rpb24gc2hvd0N1cnJlbnQoKSB7XG4gICAgICAgICRJVEVNUy5yZW1vdmVDbGFzcygnYWN0aXZlJyk7XG4gICAgICAgICRJVEVNUy5lcShDVVJSRU5UKS5hZGRDbGFzcygnYWN0aXZlJyk7XG5cbiAgICAgICAgJE5VTUJFUlMucmVtb3ZlQ2xhc3MoJ3F1aXpfcXVlc3Rpb25fX251bWJlcnNfX2l0ZW0tY3VycmVudCBxdWl6X3F1ZXN0aW9uX19udW1iZXJzX19pdGVtLXBhc3NlZCcpO1xuICAgICAgICAkTlVNQkVSU1xuICAgICAgICAgICAgLmVxKENVUlJFTlQpXG4gICAgICAgICAgICAuYWRkQ2xhc3MoJ3F1aXpfcXVlc3Rpb25fX251bWJlcnNfX2l0ZW0tY3VycmVudCcpXG4gICAgICAgICAgICAucHJldkFsbCgpXG4gICAgICAgICAgICAuYWRkQ2xhc3MoJ3F1aXpfcXVlc3Rpb25fX251bWJlcnNfX2l0ZW0tcGFzc2VkJyk7XG5cbiAgICAgICAgaWYoQ1VSUkVOVCA9PT0gMCl7XG4gICAgICAgICAgICAkUFJFVi5oaWRlKCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAkUFJFVi5zaG93KCk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBzZXR1cCgpIHtcbiAgICAgICAgJFBSRVYub24oJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIGlmKENVUlJFTlQgPT09IDApIHJldHVybjtcbiAgICAgICAgICAgIENVUlJFTlQgLT0gMTtcbiAgICAgICAgICAgIHNob3dDdXJyZW50KCk7XG4gICAgICAgIH0pO1xuICAgICAgICAkTkVYVC5vbignY2xpY2snLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgaWYoQ1VSUkVOVCA9PT0gJElURU1TLmxlbmd0aC0xKXtcbiAgICAgICAgICAgICAgICAkRk9STS5zdWJtaXQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIENVUlJFTlQgKz0gMTtcbiAgICAgICAgICAgICAgICBzaG93Q3VycmVudCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICByZXR1cm4ge1xuICAgICAgICBpbml0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAkRk9STSA9ICQoJy5qc1Rlc3RGb3JtJyk7XG4gICAgICAgICAgICAkUFJFViA9ICQoJy5qc1Rlc3RQcmV2Jyk7XG4gICAgICAgICAgICAkTkVYVCA9ICQoJy5qc1Rlc3ROZXh0Jyk7XG4gICAgICAgICAgICAkSVRFTVMgPSAkKCcuanNUZXN0TGlzdCcpLmNoaWxkcmVuKCk7XG4gICAgICAgICAgICAkTlVNQkVSUyA9ICQoJy5qc1Rlc3ROdW1iZXJzJykuY2hpbGRyZW4oKTtcbiAgICAgICAgICAgIENVUlJFTlQgPSAwO1xuXG4gICAgICAgICAgICBzZXR1cCgpO1xuICAgICAgICB9XG4gICAgfVxufSkoKTtcbmFwcFRlc3QuaW5pdCgpO1xuXG4vKiBzbGlkZXIgKi9cbnZhciBhcHBTbGlkZXIgPSAoZnVuY3Rpb24oKXtcbiAgICB2YXIgJElURU1TO1xuICAgIHZhciBJVEVNU19MRU5HVEg7XG4gICAgdmFyICRQUkVWO1xuICAgIHZhciAkTkVYVDtcbiAgICB2YXIgQ1VSUkVOVDtcblxuICAgIGZ1bmN0aW9uIHNob3dDdXJyZW50KCl7XG4gICAgICAgICRJVEVNUy5yZW1vdmVDbGFzcygnYWN0aXZlJyk7XG4gICAgICAgICRJVEVNUy5lcShDVVJSRU5UKS5hZGRDbGFzcygnYWN0aXZlJyk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gc2V0dXAoKSB7XG4gICAgICAgICRORVhULm9uKCdjbGljaycsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIENVUlJFTlQgPSBDVVJSRU5UKzEgPCBJVEVNU19MRU5HVEggPyBDVVJSRU5UKzEgOiAwO1xuICAgICAgICAgICAgc2hvd0N1cnJlbnQoKTtcbiAgICAgICAgfSk7XG4gICAgICAgICRQUkVWLm9uKCdjbGljaycsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgIENVUlJFTlQgPSBDVVJSRU5ULTEgPj0gMCA/IENVUlJFTlQtMSA6IElURU1TX0xFTkdUSC0xO1xuICAgICAgICAgICAgc2hvd0N1cnJlbnQoKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHtcbiAgICAgICAgaW5pdDogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICRJVEVNUyA9ICQoJy5tYWluX2Fkdl9fc2xpZGVyX19saXN0JykuY2hpbGRyZW4oKTtcbiAgICAgICAgICAgIElURU1TX0xFTkdUSCA9ICRJVEVNUy5sZW5ndGg7XG4gICAgICAgICAgICBpZighSVRFTVNfTEVOR1RIKSByZXR1cm47XG4gICAgICAgICAgICAkUFJFViA9ICQoJy5tYWluX2Fkdl9fc2xpZGVyX19hcnJvdy1wcmV2Jyk7XG4gICAgICAgICAgICAkTkVYVCA9ICQoJy5tYWluX2Fkdl9fc2xpZGVyX19hcnJvdy1uZXh0Jyk7XG4gICAgICAgICAgICBDVVJSRU5UID0gMDtcblxuICAgICAgICAgICAgc2V0dXAoKTtcbiAgICAgICAgfVxuICAgIH1cbn0pKCk7XG5hcHBTbGlkZXIuaW5pdCgpO1xuXG4vKiBwb3B1cCAqL1xudmFyIGFwcFBvcHVwID0gKGZ1bmN0aW9uKCl7XG4gICAgdmFyICRCT0RZO1xuICAgIHZhciAkQ09OVEVOVDtcbiAgICB2YXIgJFBPUFVQO1xuXG4gICAgZnVuY3Rpb24gb3BlbihodG1sKSB7XG4gICAgICAgIGNsb3NlKCk7XG5cbiAgICAgICAgdmFyIGJvZHlXaWR0aCA9ICRCT0RZLndpZHRoKCk7XG4gICAgICAgICRCT0RZLmNzcyh7XG4gICAgICAgICAgICBwb3NpdGlvbjogJ3JlbGF0aXZlJyxcbiAgICAgICAgICAgIG92ZXJmbG93OiAnaGlkZGVuJ1xuICAgICAgICB9KTtcbiAgICAgICAgJEJPRFkuY3NzKHtcbiAgICAgICAgICAgIHBhZGRpbmdSaWdodDogJEJPRFkud2lkdGgoKSAtIGJvZHlXaWR0aCwvL3ZlcnRpY2FsIHNjcm9sbCB3aWR0aFxuICAgICAgICAgICAgd2lkdGg6ICdhdXRvJ1xuICAgICAgICB9KTtcblxuICAgICAgICAkQ09OVEVOVC5odG1sKGh0bWwpO1xuICAgICAgICAkUE9QVVAuc2hvdygpO1xuICAgIH1cbiAgICBcbiAgICBmdW5jdGlvbiBjbG9zZSgpe1xuICAgICAgICAkUE9QVVAuaGlkZSgpO1xuICAgICAgICAkQ09OVEVOVC5odG1sKCcnKTtcbiAgICAgICAgJEJPRFkucmVtb3ZlQXR0cignc3R5bGUnKTtcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIHtcbiAgICAgICAgaW5pdDogZnVuY3Rpb24oKSB7ICAgICAgICAgICAgXG4gICAgICAgICAgICAkQk9EWSA9ICQoJ2JvZHknKTtcbiAgICAgICAgICAgICRQT1BVUCA9ICQoJycgK1xuICAgICAgICAgICAgICAgICc8ZGl2IGNsYXNzPVwicG9wdXBcIj4nICtcbiAgICAgICAgICAgICAgICAgICAgJzxkaXYgY2xhc3M9XCJwb3B1cF9fb3ZlcmxheVwiPjwvZGl2PicgK1xuICAgICAgICAgICAgICAgICAgICAnPGRpdiBjbGFzcz1cInBvcHVwX19jb250YWluZXJcIj4nICtcbiAgICAgICAgICAgICAgICAgICAgICAgICc8ZGl2IGNsYXNzPVwicG9wdXBfX2NvbnRlbnRcIj4nICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPGRpdiBjbGFzcz1cInBvcHVwX19pdGVtXCI+JyArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8ZGl2IGNsYXNzPVwicG9wdXBfX2Nsb3NlXCI+PC9kaXY+JyArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8ZGl2IGNsYXNzPVwicG9wdXBfX2l0ZW1fX2NvbnRlbnRcIj48L2Rpdj4nICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPC9kaXY+JyArXG4gICAgICAgICAgICAgICAgICAgICAgICAnPC9kaXY+JyArXG4gICAgICAgICAgICAgICAgICAgICc8L2Rpdj4nICtcbiAgICAgICAgICAgICAgICAnPC9kaXY+JyArXG4gICAgICAgICAgICAgICAgJycpO1xuICAgICAgICAgICAgJENPTlRFTlQgPSAkUE9QVVAuZmluZCgnLnBvcHVwX19pdGVtX19jb250ZW50Jyk7XG5cbiAgICAgICAgICAgICRQT1BVUFxuICAgICAgICAgICAgICAgIC5oaWRlKClcbiAgICAgICAgICAgICAgICAuZmluZCgnLnBvcHVwX19jbG9zZSwgLnBvcHVwX19vdmVybGF5JylcbiAgICAgICAgICAgICAgICAub24oJ2NsaWNrJywgZnVuY3Rpb24oZSkge1xuICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgIGNsb3NlKCk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICRCT0RZLmFwcGVuZCgkUE9QVVApO1xuXG4gICAgICAgICAgICAkQk9EWS5vbignY2xpY2snLCAnLmpzUG9wdXBDbG9zZScsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgIGNsb3NlKCk7XG4gICAgICAgICAgICB9KVxuXG4gICAgICAgIH0sXG4gICAgICAgIGNsb3NlOiBjbG9zZSxcbiAgICAgICAgb3Blbjogb3BlblxuICAgIH1cbn0pKCk7XG5hcHBQb3B1cC5pbml0KCk7XG5cbi8qIHZpZGVvICovXG4oZnVuY3Rpb24oKXtcbiAgICAkKCcubWFpbl9hZHZfX3NsaWRlcl9fbGlzdF9fcGxheScpLm9uKCdjbGljaycsIGZ1bmN0aW9uKGUpe1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIHZhciBzcmMgPSAkKHRoaXMpLmF0dHIoJ2RhdGEtc3JjJyk7XG4gICAgICAgIHZhciBodG1sID0gJzxkaXYgY2xhc3M9XCJwb3B1cF9fdmlkZW9cIj48aWZyYW1lIHNyYz1cImh0dHBzOi8vd3d3LnlvdXR1YmUuY29tL2VtYmVkLycrIHNyYyArJz9hdXRvcGxheT0xJndtb2RlPXRyYW5zcGFyZW50XCIgd2lkdGg9XCIxMDAlXCIgaGVpZ2h0PVwiMTAwJVwiIGZyYW1lYm9yZGVyPVwiMFwiIGFsbG93ZnVsbHNjcmVlbiB3bW9kZT1cIk9wYXF1ZVwiPjwvaWZyYW1lPjwvZGl2Pic7XG5cbiAgICAgICAgYXBwUG9wdXAub3BlbihodG1sKTtcbiAgICB9KTtcbn0pKCk7XG5cbi8qIGZvcm0gKi9cbihmdW5jdGlvbigpe1xuICAgIHZhciAkZm9ybSA9ICQoJy5qc0Zvcm0nKTtcbiAgICB2YXIgJGNhcEltZyA9ICRmb3JtLmZpbmQoJy5qc0Zvcm1DYXBJbWcnKTtcbiAgICB2YXIgJGNhcElucHV0ID0gJGZvcm0uZmluZCgnLmpzRm9ybUNhcElucHV0Jyk7XG4gICAgXG4gICAgdmFyIG9uUmVzcG9uc2UgPSBmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICB2YXIgbWVzc2FnZSA9ICc8ZGl2IGNsYXNzPVwicG9wdXBfX21lc3NhZ2VcIj4nKyByZXNwb25zZS5tZXNzYWdlICsnPC9kaXY+JztcbiAgICAgICAgaWYoISFyZXNwb25zZS5zdWNjZXNzKXtcbiAgICAgICAgICAgICRmb3JtLmZpbmQoJ2lucHV0LCB0ZXh0YXJlYScpLm5vdCgnOnN1Ym1pdCcpLnZhbCgnJyk7XG4gICAgICAgIH1cbiAgICAgICAgYXBwUG9wdXAub3BlbihtZXNzYWdlKTtcbiAgICAgICAgJGNhcEltZy5hdHRyKFwic3JjXCIsIHJlc3BvbnNlLnNyYyk7XG4gICAgICAgICRjYXBJbnB1dC52YWwocmVzcG9uc2Uuc2lkKTtcbiAgICB9O1xuXG4gICAgJGZvcm0ub24oJ3N1Ym1pdCcsIGZ1bmN0aW9uKGUpe1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICQuYWpheCh7XG4gICAgICAgICAgICB1cmw6ICRmb3JtLmF0dHIoJ2FjdGlvbicpLFxuICAgICAgICAgICAgZGF0YTogJGZvcm0uc2VyaWFsaXplKCksXG4gICAgICAgICAgICBkYXRhVHlwZTogJ2pzb24nLFxuICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yKTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBzdWNjZXNzOiBvblJlc3BvbnNlXG4gICAgICAgIH0pO1xuICAgIH0pO1xufSkoKTtcblxuLyogYnVyZ2VyICovXG4oZnVuY3Rpb24oKSB7XG4gICAgJCgnLmhlYWRlcl9fYnVyZ2VyJykub24oJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAkKCcuaGVhZGVyX19kcm9wJykudG9nZ2xlQ2xhc3MoJ2FjdGl2ZScpO1xuICAgIH0pXG59KSgpO1xuXG4vKiBhcnRpY2xlcyB1cGxvYWQgKi9cbihmdW5jdGlvbigpe1xuICAgIHZhciAkdXBMaXN0ID0gJCgnLmpzVXBsb2FkTGlzdCcpO1xuICAgIHZhciAkdXBCdXR0b24gPSAkKCcuanNVcGxvYWRCdXR0b24nKTtcbiAgICB2YXIgRkxBRyA9IHRydWU7XG5cbiAgICAkdXBCdXR0b24ub24oJ2NsaWNrJywgZnVuY3Rpb24oZSkge1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGlmKCFGTEFHKSByZXR1cm47XG4gICAgICAgIEZMQUcgPSBmYWxzZTtcbiAgICAgICAgdmFyIHVybCA9ICQodGhpcykuYXR0cignZGF0YS11cmwnKTtcbiAgICAgICAgJC5hamF4KHtcbiAgICAgICAgICAgIHVybDogdXJsLFxuICAgICAgICAgICAgZGF0YVR5cGU6XCJqc29uXCIsXG4gICAgICAgICAgICBlcnJvcjogZnVuY3Rpb24oZXJyb3IpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAkdXBMaXN0LmFwcGVuZChyZXNwb25zZS5odG1sKTtcbiAgICAgICAgICAgICAgICBpZihyZXNwb25zZS5pc0xhc3Qpe1xuICAgICAgICAgICAgICAgICAgICR1cEJ1dHRvbi5oaWRlKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBGTEFHID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgfSlcbn0pKCk7XG5cbi8qIHNwZWNpYWxpc3RzICovXG4kKGZ1bmN0aW9uKCl7XG4gICAgdmFyICRkb2NQb3B1cCA9ICQoJyNkb2N0b3JzX19wb3B1cCcpO1xuICAgIGlmKCRkb2NQb3B1cC5sZW5ndGgpe1xuICAgICAgICBhcHBQb3B1cC5vcGVuKCRkb2NQb3B1cC5odG1sKCkpO1xuICAgIH1cbn0pOyJdfQ==
