'use strict';

/* datepicker */
(function () {
    $('.jsDatePicker').datepicker();
})();
/* drop down menu */
(function () {
    var $header = $('.header');
    $('.header__burger').on('click', function (e) {
        e.preventDefault();
        $header.toggleClass('dropOpened');
    });
    $('.header__drop__item').on('click', function () {
        $header.removeClass('dropOpened');
    });
})();

/* faq answer */
(function () {
    $('.cabinet__faq__text').on('click', function () {
        $(this).closest('.cabinet__faq__item').toggleClass('active');
    });
})();
/* form */
(function () {
    function initForm() {
        var $form = $(this);
        $form.on('submit', function (e) {
            e.preventDefault();
            $.ajax({
                url: $form.attr('action'),
                data: $form.serialize(),
                dataType: 'json',
                error: function error(err) {
                    console.log(err);
                },
                success: function success(response) {
                    if (!!response.success) {
                        //чистим форму, если всё ок
                        $form.find('[type="text"],[type="number"],textarea').val('');
                        $form.find('select').val('default');
                    }
                    popupApp.alert(response);
                }
            });
        });
    }
    function validateBeforeSend() {
        var $form = $(this);
        var $submit = $form.find('[type="submit"]');
        var $required = $form.find('[required]');
        $submit.on('click', function (e) {
            $required.each(function () {
                var $this = $(this);
                var value = $this.val().replace(" ", "");
                if (!value.length || value == 'default') {
                    $this.addClass('error');
                    return false;
                }
            });
        });
        $form.on('keyup', '.error', function () {
            $(this).removeClass('error');
        });
    }
    $('.jsForm').each(initForm);
    $('.jsValid').each(validateBeforeSend);
    $(".jsPhoneMask").mask("+7(999) 999-99-99");
    $(".jsNumMask").keydown(function (e) {
        // Allow: backspace, delete, tab, escape, enter and .
        if ($.inArray(e.keyCode, [46, 8, 9, 27, 13, 110, 190]) !== -1 ||
        // Allow: Ctrl/cmd+A
        e.keyCode == 65 && (e.ctrlKey === true || e.metaKey === true) ||
        // Allow: Ctrl/cmd+C
        e.keyCode == 67 && (e.ctrlKey === true || e.metaKey === true) ||
        // Allow: Ctrl/cmd+X
        e.keyCode == 88 && (e.ctrlKey === true || e.metaKey === true) ||
        // Allow: home, end, left, right
        e.keyCode >= 35 && e.keyCode <= 39) {
            // let it happen, don't do anything
            return;
        }
        // Ensure that it is a number and stop the keypress
        if ((e.shiftKey || e.keyCode < 48 || e.keyCode > 57) && (e.keyCode < 96 || e.keyCode > 105)) {
            e.preventDefault();
        }
    });
})();
/* map */
(function () {
    var $map = $('#map');

    function initMap(data) {
        // Параметры карты можно задать в конструкторе.
        var map = new ymaps.Map(
        // ID DOM-элемента, в который будет добавлена карта.
        'map',
        // Параметры карты.
        {
            // Географические координаты центра отображаемой карты.
            center: data.map.center,
            // Масштаб.
            zoom: 10,
            controls: ['zoomControl', 'fullscreenControl']
        });
        map.behaviors.disable('scrollZoom');

        var collection = new ymaps.GeoObjectCollection();
        var points = data.points;
        for (var i = 0; i < points.length; i++) {
            collection.add(new ymaps.Placemark(points[i].position, {
                // hintContent: "<div class='map__hint'>"+points[i].content+"</div>",
                balloonContent: "<div class='map__balloon'>" + points[i].content + "</div>"
            }, {
                // Опции.
                // Необходимо указать данный тип макета.
                iconLayout: 'default#image',
                // Своё изображение иконки метки.
                iconImageHref: '../img/main/map_icon.png',
                // Размеры метки.
                iconImageSize: [61, 61],
                // Смещение левого верхнего угла иконки относительно
                // её "ножки" (точки привязки).
                iconImageOffset: [0, -61]
            }));
        }
        map.geoObjects.add(collection);
        map.setBounds(map.geoObjects.getBounds());
        // map.setZoom(map.getZoom()-1);
    }

    if ($map.length) {
        ymaps.ready(function () {
            $.ajax({
                url: $map.attr('data-url'),
                dataType: "json",
                error: function error(err) {
                    console.log(err);
                },
                success: initMap
            });
        });
    }
})();
/* popup */
var popupApp = function () {
    var $BASE;
    var $ITEMS;
    var $BODY;

    function close() {
        $BODY.removeClass('popupOpened');
        $BODY.css('padding-right', 0);
    }
    function open(id) {
        close();
        var $popup = $(id);
        if (!$popup.length) return;

        var width = $BODY.width();
        $ITEMS.hide();
        $popup.show();
        $BODY.addClass('popupOpened');
        $BODY.css('padding-right', $BODY.width() - width);
    }
    function setup() {
        $('.jsPopupOpen').on('click', function (e) {
            e.preventDefault();
            open($(this).attr('href'));
        });
        $BASE.on('click', '.jsPopupClose', function (e) {
            e.preventDefault();
            close();
        });
    }
    function alert(obj) {
        var $popupAlert = $('#popupMessage');
        $popupAlert.find('.popup__message').html(obj.text);
        $popupAlert.find('.popup__close').attr('href', '#' + obj.id);
        open('#popupMessage');
    }

    return {
        init: function init() {
            $BASE = $('.popup');
            $BODY = $('body');
            $ITEMS = $BASE.find('.popup__item');
            setup();
        },
        open: open,
        close: close,
        alert: alert
    };
}();
popupApp.init();
/* video */
(function () {
    var $base = $('#popupVideo');
    var $container = $base.find('.popup__video');
    var $close = $base.find('.popup__close');

    $('.jsPopupVideo').on('click', function (e) {
        e.preventDefault();
        var src = $(this).attr('data-src');
        $container.html('<iframe src="https://www.youtube.com/embed/' + src + '?autoplay=1&wmode=transparent" width="100%" height="100%" frameborder="0" allowfullscreen wmode="Opaque"></iframe>');
        popupApp.open('#popupVideo');
    });
    $close.on('click', function (e) {
        e.preventDefault();
        popupApp.close();
        $container.html('');
    });
})();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRhdGFwaWNrZXIuanMiLCJkcm9wLmpzIiwiZm9ybS5qcyIsIm1hcC5qcyIsInBvcHVwLmpzIiwidmlkZW8uanMiXSwibmFtZXMiOlsiJCIsImRhdGVwaWNrZXIiLCIkaGVhZGVyIiwib24iLCJlIiwicHJldmVudERlZmF1bHQiLCJ0b2dnbGVDbGFzcyIsInJlbW92ZUNsYXNzIiwiY2xvc2VzdCIsImluaXRGb3JtIiwiJGZvcm0iLCJhamF4IiwidXJsIiwiYXR0ciIsImRhdGEiLCJzZXJpYWxpemUiLCJkYXRhVHlwZSIsImVycm9yIiwiZXJyIiwiY29uc29sZSIsImxvZyIsInN1Y2Nlc3MiLCJyZXNwb25zZSIsImZpbmQiLCJ2YWwiLCJwb3B1cEFwcCIsImFsZXJ0IiwidmFsaWRhdGVCZWZvcmVTZW5kIiwiJHN1Ym1pdCIsIiRyZXF1aXJlZCIsImVhY2giLCIkdGhpcyIsInZhbHVlIiwicmVwbGFjZSIsImxlbmd0aCIsImFkZENsYXNzIiwibWFzayIsImtleWRvd24iLCJpbkFycmF5Iiwia2V5Q29kZSIsImN0cmxLZXkiLCJtZXRhS2V5Iiwic2hpZnRLZXkiLCIkbWFwIiwiaW5pdE1hcCIsIm1hcCIsInltYXBzIiwiTWFwIiwiY2VudGVyIiwiem9vbSIsImNvbnRyb2xzIiwiYmVoYXZpb3JzIiwiZGlzYWJsZSIsImNvbGxlY3Rpb24iLCJHZW9PYmplY3RDb2xsZWN0aW9uIiwicG9pbnRzIiwiaSIsImFkZCIsIlBsYWNlbWFyayIsInBvc2l0aW9uIiwiYmFsbG9vbkNvbnRlbnQiLCJjb250ZW50IiwiaWNvbkxheW91dCIsImljb25JbWFnZUhyZWYiLCJpY29uSW1hZ2VTaXplIiwiaWNvbkltYWdlT2Zmc2V0IiwiZ2VvT2JqZWN0cyIsInNldEJvdW5kcyIsImdldEJvdW5kcyIsInJlYWR5IiwiJEJBU0UiLCIkSVRFTVMiLCIkQk9EWSIsImNsb3NlIiwiY3NzIiwib3BlbiIsImlkIiwiJHBvcHVwIiwid2lkdGgiLCJoaWRlIiwic2hvdyIsInNldHVwIiwib2JqIiwiJHBvcHVwQWxlcnQiLCJodG1sIiwidGV4dCIsImluaXQiLCIkYmFzZSIsIiRjb250YWluZXIiLCIkY2xvc2UiLCJzcmMiXSwibWFwcGluZ3MiOiI7O0FBQUE7QUFDQSxDQUFBLFlBQUE7QUFDQUEsTUFBQSxlQUFBLEVBQUFDLFVBQUE7QUFDQSxDQUZBO0FDREE7QUFDQSxDQUFBLFlBQUE7QUFDQSxRQUFBQyxVQUFBRixFQUFBLFNBQUEsQ0FBQTtBQUNBQSxNQUFBLGlCQUFBLEVBQUFHLEVBQUEsQ0FBQSxPQUFBLEVBQUEsVUFBQUMsQ0FBQSxFQUFBO0FBQ0FBLFVBQUFDLGNBQUE7QUFDQUgsZ0JBQUFJLFdBQUEsQ0FBQSxZQUFBO0FBQ0EsS0FIQTtBQUlBTixNQUFBLHFCQUFBLEVBQUFHLEVBQUEsQ0FBQSxPQUFBLEVBQUEsWUFBQTtBQUNBRCxnQkFBQUssV0FBQSxDQUFBLFlBQUE7QUFDQSxLQUZBO0FBR0EsQ0FUQTs7QUFXQTtBQUNBLENBQUEsWUFBQTtBQUNBUCxNQUFBLHFCQUFBLEVBQUFHLEVBQUEsQ0FBQSxPQUFBLEVBQUEsWUFBQTtBQUNBSCxVQUFBLElBQUEsRUFBQVEsT0FBQSxDQUFBLHFCQUFBLEVBQUFGLFdBQUEsQ0FBQSxRQUFBO0FBQ0EsS0FGQTtBQUdBLENBSkE7QUNiQTtBQUNBLENBQUEsWUFBQTtBQUNBLGFBQUFHLFFBQUEsR0FBQTtBQUNBLFlBQUFDLFFBQUFWLEVBQUEsSUFBQSxDQUFBO0FBQ0FVLGNBQUFQLEVBQUEsQ0FBQSxRQUFBLEVBQUEsVUFBQUMsQ0FBQSxFQUFBO0FBQ0FBLGNBQUFDLGNBQUE7QUFDQUwsY0FBQVcsSUFBQSxDQUFBO0FBQ0FDLHFCQUFBRixNQUFBRyxJQUFBLENBQUEsUUFBQSxDQURBO0FBRUFDLHNCQUFBSixNQUFBSyxTQUFBLEVBRkE7QUFHQUMsMEJBQUEsTUFIQTtBQUlBQyx1QkFBQSxlQUFBQyxHQUFBLEVBQUE7QUFDQUMsNEJBQUFDLEdBQUEsQ0FBQUYsR0FBQTtBQUNBLGlCQU5BO0FBT0FHLHlCQUFBLGlCQUFBQyxRQUFBLEVBQUE7QUFD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TUFBQSxFQUFBLE1BQUFxRSxJQUFBTixFQUFBO0FBQ0FELGFBQUEsZUFBQTtBQUNBOztBQUVBLFdBQUE7QUFDQVcsY0FBQSxnQkFBQTtBQUNBaEIsb0JBQUF0RSxFQUFBLFFBQUEsQ0FBQTtBQUNBd0Usb0JBQUF4RSxFQUFBLE1BQUEsQ0FBQTtBQUNBdUUscUJBQUFELE1BQUEvQyxJQUFBLENBQUEsY0FBQSxDQUFBO0FBQ0EwRDtBQUNBLFNBTkE7QUFPQU4sY0FBQUEsSUFQQTtBQVFBRixlQUFBQSxLQVJBO0FBU0EvQyxlQUFBQTtBQVRBLEtBQUE7QUFXQSxDQWhEQSxFQUFBO0FBaURBRCxTQUFBNkQsSUFBQTtBQ2xEQTtBQUNBLENBQUEsWUFBQTtBQUNBLFFBQUFDLFFBQUF2RixFQUFBLGFBQUEsQ0FBQTtBQUNBLFFBQUF3RixhQUFBRCxNQUFBaEUsSUFBQSxDQUFBLGVBQUEsQ0FBQTtBQUNBLFFBQUFrRSxTQUFBRixNQUFBaEUsSUFBQSxDQUFBLGVBQUEsQ0FBQTs7QUFFQXZCLE1BQUEsZUFBQSxFQUFBRyxFQUFBLENBQUEsT0FBQSxFQUFBLFVBQUFDLENBQUEsRUFBQTtBQUNBQSxVQUFBQyxjQUFBO0FBQ0EsWUFBQXFGLE1BQUExRixFQUFBLElBQUEsRUFBQWEsSUFBQSxDQUFBLFVBQUEsQ0FBQTtBQUNBMkUsbUJBQUFKLElBQUEsQ0FBQSxnREFBQU0sR0FBQSxHQUFBLG9IQUFBO0FBQ0FqRSxpQkFBQWtELElBQUEsQ0FBQSxhQUFBO0FBQ0EsS0FMQTtBQU1BYyxXQUFBdEYsRUFBQSxDQUFBLE9BQUEsRUFBQSxVQUFBQyxDQUFBLEVBQUE7QUFDQUEsVUFBQUMsY0FBQTtBQUNBb0IsaUJBQUFnRCxLQUFBO0FBQ0FlLG1CQUFBSixJQUFBLENBQUEsRUFBQTtBQUNBLEtBSkE7QUFLQSxDQWhCQSIsImZpbGUiOiJtYWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyogZGF0ZXBpY2tlciAqL1xyXG4oZnVuY3Rpb24oKXtcclxuICAgICQoJy5qc0RhdGVQaWNrZXInKS5kYXRlcGlja2VyKCk7XHJcbn0pKCk7IiwiLyogZHJvcCBkb3duIG1lbnUgKi9cclxuKGZ1bmN0aW9uKCl7XHJcbiAgICB2YXIgJGhlYWRlciA9ICQoJy5oZWFkZXInKTtcclxuICAgICQoJy5oZWFkZXJfX2J1cmdlcicpLm9uKCdjbGljaycsIGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICRoZWFkZXIudG9nZ2xlQ2xhc3MoJ2Ryb3BPcGVuZWQnKTtcclxuICAgIH0pO1xyXG4gICAgJCgnLmhlYWRlcl9fZHJvcF9faXRlbScpLm9uKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAkaGVhZGVyLnJlbW92ZUNsYXNzKCdkcm9wT3BlbmVkJyk7XHJcbiAgICB9KTtcclxufSkoKTtcclxuXHJcbi8qIGZhcSBhbnN3ZXIgKi9cclxuKGZ1bmN0aW9uKCl7XHJcbiAgICAkKCcuY2FiaW5ldF9fZmFxX190ZXh0Jykub24oJ2NsaWNrJywgZnVuY3Rpb24oKXtcclxuICAgICAgICAkKHRoaXMpLmNsb3Nlc3QoJy5jYWJpbmV0X19mYXFfX2l0ZW0nKS50b2dnbGVDbGFzcygnYWN0aXZlJyk7XHJcbiAgICB9KTtcclxufSkoKTsiLCIvKiBmb3JtICovXHJcbihmdW5jdGlvbigpe1xyXG4gICAgZnVuY3Rpb24gaW5pdEZvcm0oKXtcclxuICAgICAgICB2YXIgJGZvcm0gPSAkKHRoaXMpO1xyXG4gICAgICAgICRmb3JtLm9uKCdzdWJtaXQnLCBmdW5jdGlvbihlKSB7XHJcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgJC5hamF4KHtcclxuICAgICAgICAgICAgICAgIHVybDogJGZvcm0uYXR0cignYWN0aW9uJyksXHJcbiAgICAgICAgICAgICAgICBkYXRhOiAkZm9ybS5zZXJpYWxpemUoKSxcclxuICAgICAgICAgICAgICAgIGRhdGFUeXBlOiAnanNvbicsXHJcbiAgICAgICAgICAgICAgICBlcnJvcjogZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycik7XHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYoISFyZXNwb25zZS5zdWNjZXNzKXsvL9GH0LjRgdGC0LjQvCDRhNC+0YDQvNGDLCDQtdGB0LvQuCDQstGB0ZEg0L7QulxyXG4gICAgICAgICAgICAgICAgICAgICAgICAkZm9ybS5maW5kKCdbdHlwZT1cInRleHRcIl0sW3R5cGU9XCJudW1iZXJcIl0sdGV4dGFyZWEnKS52YWwoJycpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkZm9ybS5maW5kKCdzZWxlY3QnKS52YWwoJ2RlZmF1bHQnKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgcG9wdXBBcHAuYWxlcnQocmVzcG9uc2UpOyAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBmdW5jdGlvbiB2YWxpZGF0ZUJlZm9yZVNlbmQoKXtcclxuICAgICAgICB2YXIgJGZvcm0gPSAkKHRoaXMpO1xyXG4gICAgICAgIHZhciAkc3VibWl0ID0gJGZvcm0uZmluZCgnW3R5cGU9XCJzdWJtaXRcIl0nKTtcclxuICAgICAgICB2YXIgJHJlcXVpcmVkID0gJGZvcm0uZmluZCgnW3JlcXVpcmVkXScpO1xyXG4gICAgICAgICRzdWJtaXQub24oJ2NsaWNrJywgZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAkcmVxdWlyZWQuZWFjaChmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICAgICAgdmFyICR0aGlzID0gJCh0aGlzKTtcclxuICAgICAgICAgICAgICAgIHZhciB2YWx1ZSA9ICR0aGlzLnZhbCgpLnJlcGxhY2UoXCIgXCIsXCJcIik7XHJcbiAgICAgICAgICAgICAgICBpZighdmFsdWUubGVuZ3RoIHx8IHZhbHVlID09ICdkZWZhdWx0Jyl7XHJcbiAgICAgICAgICAgICAgICAgICAgJHRoaXMuYWRkQ2xhc3MoJ2Vycm9yJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuICAgICAgICAkZm9ybS5vbigna2V5dXAnLCAnLmVycm9yJywgZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgJCh0aGlzKS5yZW1vdmVDbGFzcygnZXJyb3InKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgICQoJy5qc0Zvcm0nKS5lYWNoKGluaXRGb3JtKTtcclxuICAgICQoJy5qc1ZhbGlkJykuZWFjaCh2YWxpZGF0ZUJlZm9yZVNlbmQpO1xyXG4gICAgJChcIi5qc1Bob25lTWFza1wiKS5tYXNrKFwiKzcoOTk5KSA5OTktOTktOTlcIik7XHJcbiAgICAkKFwiLmpzTnVtTWFza1wiKS5rZXlkb3duKGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgLy8gQWxsb3c6IGJhY2tzcGFjZSwgZGVsZXRlLCB0YWIsIGVzY2FwZSwgZW50ZXIgYW5kIC5cclxuICAgICAgICBpZiAoJC5pbkFycmF5KGUua2V5Q29kZSwgWzQ2LCA4LCA5LCAyNywgMTMsIDExMCwgMTkwXSkgIT09IC0xIHx8XHJcbiAgICAgICAgICAgIC8vIEFsbG93OiBDdHJsL2NtZCtBXHJcbiAgICAgICAgICAgIChlLmtleUNvZGUgPT0gNjUgJiYgKGUuY3RybEtleSA9PT0gdHJ1ZSB8fCBlLm1ldGFLZXkgPT09IHRydWUpKSB8fFxyXG4gICAgICAgICAgICAvLyBBbGxvdzogQ3RybC9jbWQrQ1xyXG4gICAgICAgICAgICAoZS5rZXlDb2RlID09IDY3ICYmIChlLmN0cmxLZXkgPT09IHRydWUgfHwgZS5tZXRhS2V5ID09PSB0cnVlKSkgfHxcclxuICAgICAgICAgICAgLy8gQWxsb3c6IEN0cmwvY21kK1hcclxuICAgICAgICAgICAgKGUua2V5Q29kZSA9PSA4OCAmJiAoZS5jdHJsS2V5ID09PSB0cnVlIHx8IGUubWV0YUtleSA9PT0gdHJ1ZSkpIHx8XHJcbiAgICAgICAgICAgIC8vIEFsbG93OiBob21lLCBlbmQsIGxlZnQsIHJpZ2h0XHJcbiAgICAgICAgICAgIChlLmtleUNvZGUgPj0gMzUgJiYgZS5rZXlDb2RlIDw9IDM5KSkge1xyXG4gICAgICAgICAgICAvLyBsZXQgaXQgaGFwcGVuLCBkb24ndCBkbyBhbnl0aGluZ1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIEVuc3VyZSB0aGF0IGl0IGlzIGEgbnVtYmVyIGFuZCBzdG9wIHRoZSBrZXlwcmVzc1xyXG4gICAgICAgIGlmICgoZS5zaGlmdEtleSB8fCAoZS5rZXlDb2RlIDwgNDggfHwgZS5rZXlDb2RlID4gNTcpKSAmJiAoZS5rZXlDb2RlIDwgOTYgfHwgZS5rZXlDb2RlID4gMTA1KSkge1xyXG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcbn0pKCk7IiwiLyogbWFwICovXHJcbihmdW5jdGlvbigpIHtcclxuICAgIHZhciAkbWFwID0gJCgnI21hcCcpO1xyXG5cclxuICAgIGZ1bmN0aW9uIGluaXRNYXAoZGF0YSkge1xyXG4gICAgICAgIC8vINCf0LDRgNCw0LzQtdGC0YDRiyDQutCw0YDRgtGLINC80L7QttC90L4g0LfQsNC00LDRgtGMINCyINC60L7QvdGB0YLRgNGD0LrRgtC+0YDQtS5cclxuICAgICAgICB2YXIgbWFwID0gbmV3IHltYXBzLk1hcChcclxuICAgICAgICAgICAgLy8gSUQgRE9NLdGN0LvQtdC80LXQvdGC0LAsINCyINC60L7RgtC+0YDRi9C5INCx0YPQtNC10YIg0LTQvtCx0LDQstC70LXQvdCwINC60LDRgNGC0LAuXHJcbiAgICAgICAgICAgICdtYXAnLFxyXG4gICAgICAgICAgICAvLyDQn9Cw0YDQsNC80LXRgtGA0Ysg0LrQsNGA0YLRiy5cclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgLy8g0JPQtdC+0LPRgNCw0YTQuNGH0LXRgdC60LjQtSDQutC+0L7RgNC00LjQvdCw0YLRiyDRhtC10L3RgtGA0LAg0L7RgtC+0LHRgNCw0LbQsNC10LzQvtC5INC60LDRgNGC0YsuXHJcbiAgICAgICAgICAgICAgICBjZW50ZXI6IGRhdGEubWFwLmNlbnRlcixcclxuICAgICAgICAgICAgICAgIC8vINCc0LDRgdGI0YLQsNCxLlxyXG4gICAgICAgICAgICAgICAgem9vbTogMTAsXHJcbiAgICAgICAgICAgICAgICBjb250cm9sczogWyd6b29tQ29udHJvbCcsICdmdWxsc2NyZWVuQ29udHJvbCddXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICApO1xyXG4gICAgICAgIG1hcC5iZWhhdmlvcnMuZGlzYWJsZSgnc2Nyb2xsWm9vbScpO1xyXG5cclxuICAgICAgICB2YXIgY29sbGVjdGlvbiA9IG5ldyB5bWFwcy5HZW9PYmplY3RDb2xsZWN0aW9uKCk7XHJcbiAgICAgICAgdmFyIHBvaW50cyA9IGRhdGEucG9pbnRzO1xyXG4gICAgICAgIGZvcih2YXIgaT0wOyBpPHBvaW50cy5sZW5ndGg7IGkrKyApe1xyXG4gICAgICAgICAgICBjb2xsZWN0aW9uLmFkZChuZXcgeW1hcHMuUGxhY2VtYXJrKHBvaW50c1tpXS5wb3NpdGlvbiwge1xyXG4gICAgICAgICAgICAgICAgLy8gaGludENvbnRlbnQ6IFwiPGRpdiBjbGFzcz0nbWFwX19oaW50Jz5cIitwb2ludHNbaV0uY29udGVudCtcIjwvZGl2PlwiLFxyXG4gICAgICAgICAgICAgICAgYmFsbG9vbkNvbnRlbnQ6IFwiPGRpdiBjbGFzcz0nbWFwX19iYWxsb29uJz5cIitwb2ludHNbaV0uY29udGVudCtcIjwvZGl2PlwiXHJcbiAgICAgICAgICAgIH0sIHtcclxuICAgICAgICAgICAgICAgIC8vINCe0L/RhtC40LguXHJcbiAgICAgICAgICAgICAgICAvLyDQndC10L7QsdGF0L7QtNC40LzQviDRg9C60LDQt9Cw0YLRjCDQtNCw0L3QvdGL0Lkg0YLQuNC/INC80LDQutC10YLQsC5cclxuICAgICAgICAgICAgICAgIGljb25MYXlvdXQ6ICdkZWZhdWx0I2ltYWdlJyxcclxuICAgICAgICAgICAgICAgIC8vINCh0LLQvtGRINC40LfQvtCx0YDQsNC20LXQvdC40LUg0LjQutC+0L3QutC4INC80LXRgtC60LguXHJcbiAgICAgICAgICAgICAgICBpY29uSW1hZ2VIcmVmOiAnL2ltZy9tYWluL21hcF9pY29uLnBuZycsXHJcbiAgICAgICAgICAgICAgICAvLyDQoNCw0LfQvNC10YDRiyDQvNC10YLQutC4LlxyXG4gICAgICAgICAgICAgICAgaWNvbkltYWdlU2l6ZTogWzYxLCA2MV0sXHJcbiAgICAgICAgICAgICAgICAvLyDQodC80LXRidC10L3QuNC1INC70LXQstC+0LPQviDQstC10YDRhdC90LXQs9C+INGD0LPQu9CwINC40LrQvtC90LrQuCDQvtGC0L3QvtGB0LjRgtC10LvRjNC90L5cclxuICAgICAgICAgICAgICAgIC8vINC10ZEgXCLQvdC+0LbQutC4XCIgKNGC0L7Rh9C60Lgg0L/RgNC40LLRj9C30LrQuCkuXHJcbiAgICAgICAgICAgICAgICBpY29uSW1hZ2VPZmZzZXQ6IFswLCAtNjFdXHJcbiAgICAgICAgICAgIH0pKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgbWFwLmdlb09iamVjdHMuYWRkKGNvbGxlY3Rpb24pOyAgICAgICAgXHJcbiAgICAgICAgbWFwLnNldEJvdW5kcyhtYXAuZ2VvT2JqZWN0cy5nZXRCb3VuZHMoKSk7XHJcbiAgICAgICAgLy8gbWFwLnNldFpvb20obWFwLmdldFpvb20oKS0xKTtcclxuICAgIH1cclxuXHJcbiAgICBpZigkbWFwLmxlbmd0aCl7XHJcbiAgICAgICAgeW1hcHMucmVhZHkoZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgJC5hamF4KHtcclxuICAgICAgICAgICAgICAgIHVybDogJG1hcC5hdHRyKCdkYXRhLXVybCcpLFxyXG4gICAgICAgICAgICAgICAgZGF0YVR5cGU6IFwianNvblwiLFxyXG4gICAgICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycik7XHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgc3VjY2VzczogaW5pdE1hcFxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxufSkoKTsiLCIvKiBwb3B1cCAqL1xyXG52YXIgcG9wdXBBcHAgPSAoZnVuY3Rpb24oKXtcclxuICAgIHZhciAkQkFTRTtcclxuICAgIHZhciAkSVRFTVM7XHJcbiAgICB2YXIgJEJPRFk7XHJcblxyXG4gICAgZnVuY3Rpb24gY2xvc2UoKSB7XHJcbiAgICAgICAgJEJPRFkucmVtb3ZlQ2xhc3MoJ3BvcHVwT3BlbmVkJyk7XHJcbiAgICAgICAgJEJPRFkuY3NzKCdwYWRkaW5nLXJpZ2h0JywwKTtcclxuICAgIH1cclxuICAgIGZ1bmN0aW9uIG9wZW4oaWQpIHtcclxuICAgICAgICBjbG9zZSgpO1xyXG4gICAgICAgIHZhciAkcG9wdXAgPSAkKGlkKTtcclxuICAgICAgICBpZighJHBvcHVwLmxlbmd0aCkgcmV0dXJuO1xyXG4gICAgICAgIFxyXG4gICAgICAgIHZhciB3aWR0aCA9ICRCT0RZLndpZHRoKCk7XHJcbiAgICAgICAgJElURU1TLmhpZGUoKTtcclxuICAgICAgICAkcG9wdXAuc2hvdygpO1xyXG4gICAgICAgICRCT0RZLmFkZENsYXNzKCdwb3B1cE9wZW5lZCcpO1xyXG4gICAgICAgICRCT0RZLmNzcygncGFkZGluZy1yaWdodCcsJEJPRFkud2lkdGgoKS13aWR0aCk7XHJcbiAgICB9XHJcbiAgICBmdW5jdGlvbiBzZXR1cCgpIHtcclxuICAgICAgICAkKCcuanNQb3B1cE9wZW4nKS5vbignY2xpY2snLCBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgIG9wZW4oJCh0aGlzKS5hdHRyKCdocmVmJykpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgICRCQVNFLm9uKCdjbGljaycsICcuanNQb3B1cENsb3NlJywgZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgICAgIGNsb3NlKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBmdW5jdGlvbiBhbGVydChvYmopIHtcclxuICAgICAgICB2YXIgJHBvcHVwQWxlcnQgPSAkKCcjcG9wdXBNZXNzYWdlJyk7XHJcbiAgICAgICAgJHBvcHVwQWxlcnQuZmluZCgnLnBvcHVwX19tZXNzYWdlJykuaHRtbChvYmoudGV4dCk7XHJcbiAgICAgICAgJHBvcHVwQWxlcnQuZmluZCgnLnBvcHVwX19jbG9zZScpLmF0dHIoJ2hyZWYnLCAnIycrb2JqLmlkKTtcclxuICAgICAgICBvcGVuKCcjcG9wdXBNZXNzYWdlJyk7XHJcbiAgICB9IFxyXG5cclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgaW5pdDogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICRCQVNFID0gJCgnLnBvcHVwJyk7XHJcbiAgICAgICAgICAgICRCT0RZID0gJCgnYm9keScpO1xyXG4gICAgICAgICAgICAkSVRFTVMgPSAkQkFTRS5maW5kKCcucG9wdXBfX2l0ZW0nKTtcclxuICAgICAgICAgICAgc2V0dXAoKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIG9wZW46IG9wZW4sXHJcbiAgICAgICAgY2xvc2U6IGNsb3NlLFxyXG4gICAgICAgIGFsZXJ0OiBhbGVydFxyXG4gICAgfVxyXG59KSgpO1xyXG5wb3B1cEFwcC5pbml0KCk7IiwiLyogdmlkZW8gKi9cclxuKGZ1bmN0aW9uKCl7XHJcbiAgICB2YXIgJGJhc2UgPSAkKCcjcG9wdXBWaWRlbycpO1xyXG4gICAgdmFyICRjb250YWluZXIgPSAkYmFzZS5maW5kKCcucG9wdXBfX3ZpZGVvJyk7XHJcbiAgICB2YXIgJGNsb3NlID0gJGJhc2UuZmluZCgnLnBvcHVwX19jbG9zZScpO1xyXG5cclxuICAgICQoJy5qc1BvcHVwVmlkZW8nKS5vbignY2xpY2snLCBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICB2YXIgc3JjID0gJCh0aGlzKS5hdHRyKCdkYXRhLXNyYycpO1xyXG4gICAgICAgICRjb250YWluZXIuaHRtbCgnPGlmcmFtZSBzcmM9XCJodHRwczovL3d3dy55b3V0dWJlLmNvbS9lbWJlZC8nKyBzcmMgKyc/YXV0b3BsYXk9MSZ3bW9kZT10cmFuc3BhcmVudFwiIHdpZHRoPVwiMTAwJVwiIGhlaWdodD1cIjEwMCVcIiBmcmFtZWJvcmRlcj1cIjBcIiBhbGxvd2Z1bGxzY3JlZW4gd21vZGU9XCJPcGFxdWVcIj48L2lmcmFtZT4nKTtcclxuICAgICAgICBwb3B1cEFwcC5vcGVuKCcjcG9wdXBWaWRlbycpO1xyXG4gICAgfSk7XHJcbiAgICAkY2xvc2Uub24oJ2NsaWNrJywgZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgcG9wdXBBcHAuY2xvc2UoKTtcclxuICAgICAgICAkY29udGFpbmVyLmh0bWwoJycpO1xyXG4gICAgfSk7XHJcbn0pKCk7Il19
